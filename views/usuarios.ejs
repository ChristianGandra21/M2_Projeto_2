<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <title>UsuÃ¡rios</title>
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <h1>ğŸ‘¤ UsuÃ¡rios</h1>
    <nav>
      <a href="/">â¬…ï¸ Voltar</a>
    </nav>

    <ul id="user-list"></ul>

    <!-- SeÃ§Ã£o de UsuÃ¡rios -->
    <div class="card">
      <div class="section-header">
        <h2>ğŸ‘¥ Lista de UsuÃ¡rios</h2>
        <a href="/users/new" class="btn btn-success">ğŸ‘¤ Criar UsuÃ¡rio</a>
      </div>

      <% if (users.length === 0) { %>
      <div class="alert alert-info">
        <p>
          Nenhum usuÃ¡rio cadastrado.
          <a href="/users/new">Criar primeiro usuÃ¡rio</a>
        </p>
      </div>
      <% } else { %>
      <div class="users-grid">
        <% users.forEach(user => { %>
        <div class="user-card">
          <div class="user-avatar">
            <span class="avatar-text">
              <%= user.name.charAt(0).toUpperCase() %>
            </span>
          </div>

          <div class="user-info">
            <h3 class="user-name"><%= user.name %></h3>
            <p class="user-email">ğŸ“§ <%= user.email %></p>
            <p class="user-id">ğŸ†” ID: <%= user.id %></p>
            <% if (user.created_at) { %>
            <p class="user-date">
              ğŸ“… <%= new Date(user.created_at).toLocaleDateString('pt-BR') %>
            </p>
            <% } %>
          </div>

          <div class="user-actions">
            <a
              href="/users/edit/<%= user.id %>"
              class="btn btn-sm btn-secondary"
              >âœï¸ Editar</a
            >
            <a href="/users/delete/<%= user.id %>" class="btn btn-sm btn-danger"
              >ğŸ—‘ï¸ Excluir</a
            >
          </div>
        </div>
        <% }) %>
      </div>
      <% } %>
    </div>

    <!-- Container para mensagens -->
    <div id="messages-container"></div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Mostrar mensagens de sucesso/erro baseadas nos parÃ¢metros da URL
        const urlParams = new URLSearchParams(window.location.search);
        const success = urlParams.get("success");
        const name = urlParams.get("name");
        const messagesContainer = document.getElementById("messages-container");

        if (success && messagesContainer) {
          let message = "";
          let alertClass = "alert-success";

          switch (success) {
            case "user_created":
              message = `âœ… UsuÃ¡rio "${
                name || "sem nome"
              }" foi criado com sucesso!`;
              break;
            case "user_updated":
              message = `âœ… UsuÃ¡rio "${
                name || "sem nome"
              }" foi atualizado com sucesso!`;
              break;
            case "user_deleted":
              message = `âœ… UsuÃ¡rio "${
                name || "sem nome"
              }" foi excluÃ­do com sucesso!`;
              break;
            case "user_deleted_forced":
              const tasks = urlParams.get("tasks");
              message = `âš ï¸ UsuÃ¡rio "${
                name || "sem nome"
              }" foi excluÃ­do via EXCLUSÃƒO FORÃ‡ADA! ${tasks} tarefa(s) tambÃ©m foram removidas.`;
              alertClass = "alert-warning";
              break;
            default:
              message = "âœ… OperaÃ§Ã£o realizada com sucesso!";
          }

          if (message) {
            const alertDiv = document.createElement("div");
            alertDiv.className = `alert ${alertClass}`;
            alertDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>${message}</span>
                        <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; font-size: 18px; cursor: pointer; color: #155724;">Ã—</button>
                    </div>
                `;
            messagesContainer.appendChild(alertDiv);

            // Auto-remover apÃ³s 5 segundos
            setTimeout(() => {
              if (alertDiv.parentNode) {
                alertDiv.remove();
              }
            }, 5000);

            // Limpar URL sem recarregar a pÃ¡gina
            const newUrl = window.location.pathname;
            window.history.replaceState({}, document.title, newUrl);
          }
        }
      });
    </script>
  </body>
</html>
