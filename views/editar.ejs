<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title || 'Editar' %></title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <% if (typeof task !== 'undefined' && task) { %>
                <h1>‚úèÔ∏è Editar Tarefa: <%= task.title %></h1>
            <% } else if (typeof user !== 'undefined' && user) { %>
                <h1>‚úèÔ∏è Editar Usu√°rio: <%= user.name %></h1>
            <% } else { %>
                <h1>‚úèÔ∏è Editar Item</h1>
            <% } %>
            <nav>
                <a href="/tasks" class="btn btn-secondary">‚¨ÖÔ∏è Voltar para Lista</a>
                <% if (typeof task !== 'undefined' && task) { %>
                    <a href="/tasks/new" class="btn btn-primary">‚ûï Nova Tarefa</a>
                <% } else if (typeof user !== 'undefined' && user) { %>
                    <a href="/users/new" class="btn btn-success">üë§ Novo Usu√°rio</a>
                <% } %>
            </nav>
        </header>

        <main>
            <% if (typeof task !== 'undefined' && task) { %>
                <!-- Formul√°rio de Edi√ß√£o de Tarefa -->
                <div class="card">
                    <div class="form-header">
                        <h2>üìù Editar Dados da Tarefa</h2>
                        <p>Modifique os campos abaixo para atualizar a tarefa</p>
                    </div>

                    <form action="/tasks/edit/<%= task.id %>" method="POST" class="form">
                        <div class="form-group">
                            <label for="title" class="form-label">
                                <span class="label-text">üìã T√≠tulo da Tarefa *</span>
                                <input
                                    type="text"
                                    id="title"
                                    name="title"
                                    class="form-control"
                                    value="<%= task.title %>"
                                    placeholder="Ex: Finalizar relat√≥rio mensal"
                                    required
                                    maxlength="100"
                                >
                            </label>
                            <small class="form-help">T√≠tulo obrigat√≥rio (m√°ximo 100 caracteres)</small>
                        </div>

                        <div class="form-group">
                            <label for="description" class="form-label">
                                <span class="label-text">üìÑ Descri√ß√£o</span>
                                <textarea
                                    id="description"
                                    name="description"
                                    class="form-control"
                                    rows="4"
                                    placeholder="Descreva os detalhes da tarefa..."
                                    maxlength="500"
                                ><%= task.description || '' %></textarea>
                            </label>
                            <small class="form-help">Descri√ß√£o opcional (m√°ximo 500 caracteres)</small>
                        </div>

                        <div class="form-group">
                            <label for="user_id" class="form-label">
                                <span class="label-text">üë§ Respons√°vel</span>
                                <select id="user_id" name="user_id" class="form-control">
                                    <option value="">Selecione um usu√°rio respons√°vel</option>
                                    <% users.forEach(user => { %>
                                        <option value="<%= user.id %>" <%= task.user_id === user.id ? 'selected' : '' %>>
                                            <%= user.name %> (<%= user.email %>)
                                        </option>
                                    <% }) %>
                                </select>
                            </label>
                            <small class="form-help">Usu√°rio respons√°vel pela tarefa</small>
                        </div>

                        <div class="form-group">
                            <label for="due_date" class="form-label">
                                <span class="label-text">üìÖ Data de Vencimento</span>
                                <input
                                    type="date"
                                    id="due_date"
                                    name="due_date"
                                    class="form-control"
                                    value="<%= task.due_date ? task.due_date.toISOString().split('T')[0] : '' %>"
                                >
                            </label>
                            <small class="form-help">Data limite para conclus√£o da tarefa</small>
                        </div>

                        <div class="form-group">
                            <label for="completed" class="form-label checkbox-label">
                                <input
                                    type="checkbox"
                                    id="completed"
                                    name="completed"
                                    value="true"
                                    <%= task.completed ? 'checked' : '' %>
                                >
                                <span class="label-text">‚úÖ Tarefa Conclu√≠da</span>
                            </label>
                            <small class="form-help">Marque se a tarefa foi finalizada</small>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary btn-large">
                                üíæ Salvar Altera√ß√µes
                            </button>
                            <a href="/tasks" class="btn btn-secondary btn-large">
                                ‚ùå Cancelar
                            </a>
                        </div>
                    </form>
                </div>
            <% } else if (typeof user !== 'undefined' && user) { %>
                <!-- Formul√°rio de Edi√ß√£o de Usu√°rio -->
                <div class="card">
                    <div class="form-header">
                        <h2>üë§ Editar Dados do Usu√°rio</h2>
                        <p>Modifique os campos abaixo para atualizar o usu√°rio</p>
                    </div>

                    <form action="/users/edit/<%= user.id %>" method="POST" class="form">
                        <div class="form-group">
                            <label for="name" class="form-label">
                                <span class="label-text">üë§ Nome Completo *</span>
                                <input
                                    type="text"
                                    id="name"
                                    name="name"
                                    class="form-control"
                                    value="<%= user.name %>"
                                    placeholder="Ex: Jo√£o Silva"
                                    required
                                    maxlength="100"
                                >
                            </label>
                            <small class="form-help">Nome obrigat√≥rio (m√°ximo 100 caracteres)</small>
                        </div>

                        <div class="form-group">
                            <label for="email" class="form-label">
                                <span class="label-text">üìß Email *</span>
                                <input
                                    type="email"
                                    id="email"
                                    name="email"
                                    class="form-control"
                                    value="<%= user.email %>"
                                    placeholder="Ex: joao@exemplo.com"
                                    required
                                    maxlength="150"
                                >
                            </label>
                            <small class="form-help">Email v√°lido obrigat√≥rio (m√°ximo 150 caracteres)</small>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-success btn-large">
                                üíæ Salvar Altera√ß√µes
                            </button>
                            <a href="/users" class="btn btn-secondary btn-large">
                                ‚ùå Cancelar
                            </a>
                        </div>
                    </form>
                </div>
            <% } %>

            <!-- Informa√ß√µes do Item -->
            <div class="card">
                <h3>‚ÑπÔ∏è Informa√ß√µes</h3>
                <% if (typeof task !== 'undefined' && task) { %>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">üÜî ID da Tarefa:</span>
                            <span class="info-value"><%= task.id %></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">üìä Status:</span>
                            <span class="info-value <%= task.completed ? 'status-completed' : 'status-pending' %>">
                                <%= task.completed ? '‚úÖ Conclu√≠da' : '‚è≥ Pendente' %>
                            </span>
                        </div>
                        <% if (task.created_at) { %>
                            <div class="info-item">
                                <span class="info-label">üìÖ Criada em:</span>
                                <span class="info-value"><%= new Date(task.created_at).toLocaleDateString('pt-BR') %></span>
                            </div>
                        <% } %>
                    </div>
                <% } else if (typeof user !== 'undefined' && user) { %>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">üÜî ID do Usu√°rio:</span>
                            <span class="info-value"><%= user.id %></span>
                        </div>
                        <% if (user.created_at) { %>
                            <div class="info-item">
                                <span class="info-label">üìÖ Cadastrado em:</span>
                                <span class="info-value"><%= new Date(user.created_at).toLocaleDateString('pt-BR') %></span>
                            </div>
                        <% } %>
                    </div>
                <% } %>
            </div>
        </main>
    </div>

    <script>
        // Valida√ß√£o do formul√°rio
        document.querySelector('form').addEventListener('submit', function(e) {
            // Verificar se √© formul√°rio de tarefa
            const titleField = document.getElementById('title');
            if (titleField) {
                const title = titleField.value.trim();

                if (!title) {
                    e.preventDefault();
                    alert('‚ö†Ô∏è O t√≠tulo da tarefa √© obrigat√≥rio!');
                    titleField.focus();
                    return false;
                }

                if (title.length > 100) {
                    e.preventDefault();
                    alert('‚ö†Ô∏è O t√≠tulo deve ter no m√°ximo 100 caracteres!');
                    titleField.focus();
                    return false;
                }
            }

            // Verificar se √© formul√°rio de usu√°rio
            const nameField = document.getElementById('name');
            const emailField = document.getElementById('email');
            if (nameField && emailField) {
                const name = nameField.value.trim();
                const email = emailField.value.trim();

                if (!name) {
                    e.preventDefault();
                    alert('‚ö†Ô∏è O nome √© obrigat√≥rio!');
                    nameField.focus();
                    return false;
                }

                if (!email) {
                    e.preventDefault();
                    alert('‚ö†Ô∏è O email √© obrigat√≥rio!');
                    emailField.focus();
                    return false;
                }

                // Valida√ß√£o b√°sica de email
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    e.preventDefault();
                    alert('‚ö†Ô∏è Por favor, insira um email v√°lido!');
                    emailField.focus();
                    return false;
                }
            }
        });

        // Contador de caracteres para descri√ß√£o (apenas se existir)
        const description = document.getElementById('description');
        if (description) {
            description.addEventListener('input', function() {
                const remaining = 500 - this.value.length;
                const help = this.parentNode.nextElementSibling;
                help.textContent = `Descri√ß√£o opcional (${remaining} caracteres restantes)`;

                if (remaining < 50) {
                    help.style.color = '#e74c3c';
                } else {
                    help.style.color = '#666';
                }
            });
        }
    </script>
</body>
</html>
