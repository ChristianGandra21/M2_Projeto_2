<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Lista de Tarefas</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<header><%- include('partials/header') %></header>
<body>
  <h1>📋 Lista de Tarefas</h1>

  <nav>
    <a href="/">🏠 Tarefas</a> |
    <a href="/tasks/new">🆕 Nova Tarefa</a> |
    <a href="/users">👤 Usuários</a>
  </nav>

  <section id="task-list">
    <h2>📋 Lista de Tarefas Interativa</h2>
    <div id="tasks-container"></div>
  </section>

  <script>
    const renderTasks = async () => {
      const res = await fetch('/api/tasks');
      const tasks = await res.json();

      const container = document.getElementById('tasks-container');
      container.innerHTML = '';

      tasks.forEach(tarefa => {
        const div = document.createElement('div');
        div.innerHTML = `
          <h3>${tarefa.title}</h3>
          <p>${tarefa.description}</p>
          <p>📅 ${new Date(tarefa.due_date).toLocaleDateString()}</p>
          <p>👤 ${tarefa.user}</p>
          <p>${tarefa.completed ? '✅ Concluída' : '⏳ Pendente'}</p>
          <button onclick="concluir(${tarefa.id})">✔️ Concluir</button>
          <button onclick="editar(${tarefa.id})">✏️ Editar</button>
          <button onclick="excluir(${tarefa.id})">🗑️ Excluir</button>
          <hr>
        `;
        container.appendChild(div);
      });
    };

    async function concluir(id) {
      await fetch(`/api/tasks/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ completed: true })
      });
      renderTasks();
    }

    function editar(id) {
      window.location.href = `/tasks/edit/${id}`;
    }

    async function excluir(id) {
      await fetch(`/api/tasks/${id}`, { method: 'DELETE' });
      renderTasks();
    }

    renderTasks();
  </script>
  <%- include('partials/footer') %>
</body>
</html>
